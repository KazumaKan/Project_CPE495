#ğŸ”¹ 1. Import à¹„à¸¥à¸šà¸£à¸²à¸£à¸µà¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from scipy import stats

#********************************************************************************************************************
# ğŸ”¹ 2. à¸­à¹ˆà¸²à¸™à¹„à¸Ÿà¸¥à¹Œ CSV à¹à¸¥à¸°à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™à¸‚à¸­à¸‡à¸­à¸²à¸à¸²à¸¨ (Air Quality)
file_path_air = "../RawData/sukhothai-thammathirat.csv"
st_air = pd.read_csv(file_path_air)

# à¹à¸ªà¸”à¸‡à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
print("ğŸ” à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¹„à¸Ÿà¸¥à¹Œ Air Quality CSV:")
print(st_air.head())

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
print("\nâ„¹ï¸ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™:")
print(st_air.info())

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸«à¸²à¸¢à¹„à¸›
print("\nâš ï¸ à¸ˆà¸³à¸™à¸§à¸™à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸«à¸²à¸¢à¹„à¸›à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ:")
print(st_air.isnull().sum())

# ******************************************************************************************
# ğŸ”¹ 3. à¹à¸›à¸¥à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ date à¹€à¸›à¹‡à¸™ datetime
# à¹à¸›à¸¥à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ 'date' à¹€à¸›à¹‡à¸™ datetime
st_air["date"] = pd.to_datetime(st_air["date"], errors="coerce")

# à¸¥à¸šà¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸­à¸­à¸à¸ˆà¸²à¸à¸Šà¸·à¹ˆà¸­à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ
st_air.columns = st_air.columns.str.strip()

# à¹à¸›à¸¥à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸„à¹ˆà¸²à¸¡à¸¥à¸à¸´à¸©à¸ˆà¸²à¸ object à¹€à¸›à¹‡à¸™ float
cols = ["pm25", "pm10", "o3", "no2", "so2", "co", "psi"]
cols_available = [col for col in cols if col in st_air.columns]

st_air[cols_available] = st_air[cols_available].apply(pd.to_numeric, errors="coerce")

# à¹à¸ªà¸”à¸‡à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¥à¸±à¸‡à¹à¸›à¸¥à¸‡
print("\nâœ… à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¥à¸±à¸‡à¹à¸›à¸¥à¸‡:")
print(st_air.dtypes)

# ******************************************************************************************
# ğŸ”¹ 4. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
print("\nğŸ“… à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™ Air Quality:")
print(f"à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™: {st_air['date'].min()} â†’ à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”: {st_air['date'].max()}")

#  ******************************************************************************************


#  ******************************************************************************************
# 1ï¸âƒ£ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¹ˆà¸²à¸‹à¹‰à¸³ (Duplicates)
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸–à¸§à¸‹à¹‰à¸³
duplicates = st_air[st_air.duplicated()]

# à¹à¸ªà¸”à¸‡à¹à¸–à¸§à¸—à¸µà¹ˆà¸‹à¹‰à¸³
print("\nğŸ“‹ à¹à¸–à¸§à¸‹à¹‰à¸³à¹ƒà¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥:")
print(duplicates)

#  ******************************************************************************************
# 2ï¸âƒ£ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¹ˆà¸²à¸«à¸²à¸¢à¹„à¸› (Missing Data)
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ˆà¸³à¸™à¸§à¸™à¸„à¹ˆà¸²à¸«à¸²à¸¢à¹„à¸›à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ
missing_values = st_air.isnull().sum()

# à¹à¸ªà¸”à¸‡à¸„à¹ˆà¸²à¸«à¸²à¸¢à¹„à¸›
print("\nâš ï¸ à¸ˆà¸³à¸™à¸§à¸™à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸«à¸²à¸¢à¹„à¸›à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ:")
print(missing_values)

# à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸±à¸šà¸„à¹ˆà¸²à¸«à¸²à¸¢à¹„à¸› (à¹€à¸Šà¹ˆà¸™ à¹€à¸•à¸´à¸¡à¸„à¹ˆà¸² à¸«à¸£à¸·à¸­ à¸¥à¸šà¹à¸–à¸§à¸—à¸µà¹ˆà¸¡à¸µà¸„à¹ˆà¸² missing)
# à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¹€à¸•à¸´à¸¡à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸«à¸²à¸¢à¹„à¸›à¸”à¹‰à¸§à¸¢à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢ (à¹€à¸‰à¸à¸²à¸°à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸•à¸±à¸§à¹€à¸¥à¸‚)
st_air.fillna(st_air.mean(), inplace=True)

# à¸«à¸£à¸·à¸­à¸ˆà¸°à¸¥à¸šà¹à¸–à¸§à¸—à¸µà¹ˆà¸¡à¸µà¸„à¹ˆà¸²à¸«à¸²à¸¢à¹„à¸›
# st_air_filtered.dropna(inplace=True)

print("\nâœ… à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸«à¸²à¸¢à¹„à¸›à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¹à¸¥à¹‰à¸§.")

#  ******************************************************************************************
# 3ï¸âƒ£ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¹ˆà¸²à¸œà¸´à¸”à¸›à¸à¸•à¸´ (Outliers)
from scipy.stats import zscore

# à¸„à¸³à¸™à¸§à¸“ Z-score à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸°à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚
z_scores = np.abs(zscore(st_air[cols_available]))

# à¸à¸³à¸«à¸™à¸”à¸„à¹ˆà¸² threshold à¹€à¸à¸·à¹ˆà¸­à¸«à¸²à¸„à¹ˆà¸²à¸œà¸´à¸”à¸›à¸à¸•à¸´ (à¹€à¸Šà¹ˆà¸™ Z-score > 3 à¸–à¸·à¸­à¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¸„à¹ˆà¸²à¸œà¸´à¸”à¸›à¸à¸•à¸´)
outliers = (z_scores > 3).sum(axis=0)

# à¹à¸ªà¸”à¸‡à¸„à¹ˆà¸²à¸œà¸´à¸”à¸›à¸à¸•à¸´
print("\nğŸš¨ à¸„à¹ˆà¸²à¸œà¸´à¸”à¸›à¸à¸•à¸´à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ:")
print(outliers)

#  ******************************************************************************************
# 4ï¸âƒ£ à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Descriptive Statistics)
# à¸ªà¸£à¸¸à¸›à¸ªà¸–à¸´à¸•à¸´à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
print("\nğŸ“Š à¸ªà¸–à¸´à¸•à¸´à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥:")
print(st_air.describe())

#  ******************************************************************************************
# 5ï¸âƒ£ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸‚à¸­à¸‡à¸•à¸±à¸§à¹à¸›à¸£ (Correlation Analysis)
# à¸„à¸³à¸™à¸§à¸“à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ (correlation) à¸‚à¸­à¸‡à¸•à¸±à¸§à¹à¸›à¸£à¹ƒà¸™ DataFrame
correlation_matrix = st_air[cols_available].corr()

# à¹à¸ªà¸”à¸‡à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š heatmap
plt.figure(figsize=(10, 6))
sns.heatmap(correlation_matrix, annot=True, cmap="coolwarm", fmt=".2f", linewidths=0.5)
plt.title("ğŸ“Š à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸•à¸±à¸§à¹à¸›à¸£")
plt.show()

# ******************************************************************************************
# ğŸ”¹ 5. à¸à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‰à¸à¸²à¸°à¸›à¸µ 2020 - 2024
st_air_filtered = st_air[
    (st_air["date"].dt.year >= 2020) & (st_air["date"].dt.year <= 2024)
].copy()  # à¹ƒà¸Šà¹‰ .copy() à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ Warning

# à¹à¸ªà¸”à¸‡à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸–à¸¹à¸à¸à¸£à¸­à¸‡
print("\nğŸ“† à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Air Quality à¸«à¸¥à¸±à¸‡à¸à¸£à¸­à¸‡ (2020-2024):")
print(st_air_filtered.head())

# à¹à¸ªà¸”à¸‡à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸«à¸¥à¸±à¸‡à¸à¸£à¸­à¸‡
print(f"à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²: {st_air_filtered['date'].min()} â†’ {st_air_filtered['date'].max()}")

# à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸«à¸¡à¹ˆà¹€à¸à¸·à¹ˆà¸­à¹€à¸à¹‡à¸šà¸„à¹ˆà¸² à¸›à¸µ-à¹€à¸”à¸·à¸­à¸™
st_air_filtered["year_month"] = st_air_filtered["date"].dt.to_period("M")

# à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¹à¸–à¸§à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¹€à¸”à¸·à¸­à¸™
monthly_counts = st_air_filtered.groupby("year_month").size().reset_index(name="count")

# à¹à¸ªà¸”à¸‡à¸ˆà¸³à¸™à¸§à¸™à¹à¸–à¸§à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸¸à¸à¹€à¸”à¸·à¸­à¸™
print("\nğŸ“Š à¸ˆà¸³à¸™à¸§à¸™à¹à¸–à¸§à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¹€à¸”à¸·à¸­à¸™:")
print(monthly_counts.to_string(index=False))
